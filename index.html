<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital X-RAY | Consent Trap</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        :root { --neon: #00ff41; --alert: #ff3e3e; --warn: #ffca28; --bg: #050505; --card: #111; --blue: #00f3ff; }
        body { font-family: 'Segoe UI', 'Courier New', monospace; background: var(--bg); color: #ccc; margin: 0; padding: 0; overflow-x: hidden; }
        
        /* Layout Sfocabile */
        #main-interface { padding: 20px; transition: filter 0.5s ease; filter: blur(10px); pointer-events: none; }
        .wrapper { max-width: 1200px; margin: auto; }

        /* --- IL POPUP TRAPPOLA (MODAL) --- */
        #consent-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .modal-content {
            background: #111; border: 2px solid var(--neon); padding: 30px;
            max-width: 500px; text-align: center; box-shadow: 0 0 50px rgba(0, 255, 65, 0.2);
            border-radius: 8px;
        }
        .modal-content h2 { color: #fff; margin-top: 0; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .modal-text { color: #aaa; margin: 20px 0; font-size: 0.9rem; line-height: 1.5; }
        .btn-group { display: flex; gap: 20px; justify-content: center; margin-top: 25px; }
        
        button {
            padding: 15px 30px; font-family: monospace; font-size: 1rem; font-weight: bold;
            cursor: pointer; border: none; transition: 0.3s;
        }
        .btn-accept { background: var(--neon); color: #000; box-shadow: 0 0 10px var(--neon); }
        .btn-accept:hover { background: #fff; }
        
        .btn-deny { background: transparent; border: 2px solid var(--alert); color: var(--alert); }
        .btn-deny:hover { background: var(--alert); color: #000; box-shadow: 0 0 15px var(--alert); }

        /* Messaggio di Errore quando negano */
        #trap-message {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--alert); color: #000; font-weight: bold; padding: 15px 30px;
            z-index: 10000; display: none; border: 2px solid #fff;
            animation: shake 0.5s; text-transform: uppercase;
        }

        /* --- STILI INTERFACCIA STANDARD --- */
        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--neon); padding-bottom: 15px; }
        h1 { color: var(--neon); margin: 0; text-transform: uppercase; letter-spacing: 4px; font-size: 2rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .card { background: var(--card); border: 1px solid #333; border-left: 3px solid var(--neon); padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.7); }
        h2 { color: var(--neon); font-size: 1.1rem; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; }
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; font-size: 0.85rem; }
        .label { color: #888; font-weight: bold; }
        .val { color: var(--blue); font-weight: bold; text-align: right; font-family: monospace; }
        .highlight { color: var(--neon); }
        .danger { color: var(--alert); }
        #map { height: 200px; width: 100%; margin-top: 15px; border: 1px solid var(--neon); filter: invert(100%) hue-rotate(180deg) brightness(90%) contrast(120%); }

        @keyframes shake { 0% { transform: translateX(-55%); } 25% { transform: translateX(-45%); } 50% { transform: translateX(-55%); } 75% { transform: translateX(-45%); } 100% { transform: translateX(-50%); } }
    </style>
</head>
<body>

<div id="trap-message">‚ö†Ô∏è DENIAL FAILED: IP CONNECTION CANNOT BE HIDDEN. TRACKING ACTIVE.</div>

<div id="consent-modal">
    <div class="modal-content">
        <h2>üîí Security Gateway</h2>
        <div class="modal-text">
            This system utilizes advanced heuristic analysis and network telemetry.<br><br>
            Do you consent to sharing your <b>IP Address, Geolocation, and Hardware Fingerprint</b> for forensic analysis?
        </div>
        <div class="btn-group">
            <button class="btn-deny" onclick="triggerTrap()">NO, DENY ACCESS</button>
            <button class="btn-accept" onclick="unlockSite()">YES, I CONSENT</button>
        </div>
        <p style="font-size: 0.7rem; color: #555; margin-top: 20px;">*Denial may limit functionality.</p>
    </div>
</div>

<div id="main-interface">
    <div class="wrapper">
        <header>
            <h1>Digital X-RAY v6.0</h1>
            <div style="color: var(--blue); font-size: 0.8rem; letter-spacing: 2px;">>>> SURVEILLANCE ACTIVE <<<</div>
        </header>
        
        <div class="grid">
            <div class="card" style="border-left-color: var(--blue);">
                <h2>üì° Network Analysis</h2>
                <div class="row"><span class="label">Public IPv4:</span> <span id="ip" class="val highlight">SCANNING...</span></div>
                <div class="row"><span class="label">ISP / Carrier:</span> <span id="isp" class="val">...</span></div>
                <div class="row"><span class="label">Location:</span> <span id="geo" class="val">...</span></div>
                <div class="row"><span class="label">Timezone:</span> <span id="ip-tz" class="val">...</span></div>
                <div id="vpn-warn" style="display:none; color:var(--alert); font-weight:bold; margin-top:10px; border:1px solid var(--alert); padding:5px;">‚ö†Ô∏è VPN DETECTED</div>
                <div id="map"></div>
            </div>

            <div class="card">
                <h2>üì± Hardware Fingerprint</h2>
                <div class="row"><span class="label">Model:</span> <span id="model" class="val">DETECTING...</span></div>
                <div class="row"><span class="label">OS:</span> <span id="os" class="val"></span></div>
                <div class="row"><span class="label">CPU:</span> <span id="cpu" class="val"></span></div>
                <div class="row"><span class="label">GPU:</span> <span id="gpu" class="val"></span></div>
                <div class="row"><span class="label">Battery:</span> <span id="battery" class="val">N/A</span></div>
            </div>

            <div class="card" style="border-left-color: var(--alert);">
                <h2>üß¨ Persistent Identifiers</h2>
                <div class="row"><span class="label">Canvas ID:</span> <span id="fp" class="val danger">WAITING...</span></div>
                <div class="row"><span class="label">Audio ID:</span> <span id="audio-fp" class="val danger">WAITING...</span></div>
                
                <h3 style="color: var(--neon); font-size: 0.9rem; margin-top: 20px; border-bottom: 1px solid #333;">üßü Storage Audit</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <div style="background:#222; padding:5px;">üç™ Cookies: <span id="audit-cookie" class="clean">Checking</span></div>
                    <div style="background:#222; padding:5px;">üì¶ Storage: <span id="audit-ls" class="clean">Checking</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<canvas id="canv" width="200" height="50" style="display:none;"></canvas>

<script>
    // --- GESTIONE TRAPPOLA ---
    function unlockSite() {
        document.getElementById('consent-modal').style.display = 'none';
        document.getElementById('main-interface').style.filter = 'none';
        document.getElementById('main-interface').style.pointerEvents = 'auto';
        startScanning(); // Avvia scansione "consensuale"
    }

    function triggerTrap() {
        document.getElementById('consent-modal').style.display = 'none';
        document.getElementById('main-interface').style.filter = 'none';
        document.getElementById('main-interface').style.pointerEvents = 'auto';
        
        // MOSTRA IL MESSAGGIO "TRAPPOLA"
        const msg = document.getElementById('trap-message');
        msg.style.display = 'block';
        
        // Avvia comunque la scansione!
        startScanning();
        
        // Nascondi messaggio dopo 5 secondi
        setTimeout(() => { msg.style.display = 'none'; }, 6000);
    }

    // --- FUNZIONI DI SCANSIONE (Partono solo dopo il click) ---
    function startScanning() {
        // 1. NETWORK & MAP
        async function initNetwork() {
            const sources = [
                { url: 'https://ipwho.is/', map: d => ({ ip: d.ip, geo: `${d.city}, ${d.country}`, isp: d.connection.isp, lat: d.latitude, lon: d.longitude, tz: d.timezone.id }) }
            ];
            for(const source of sources) {
                try {
                    const res = await fetch(source.url);
                    if(!res.ok) throw new Error("Err");
                    const data = source.map(await res.json());

                    document.getElementById('ip').innerText = data.ip;
                    document.getElementById('geo').innerText = data.geo;
                    document.getElementById('isp').innerText = data.isp;
                    document.getElementById('ip-tz').innerText = data.tz;

                    // Mappa
                    if(data.lat && typeof L !== 'undefined') {
                        const map = L.map('map').setView([data.lat, data.lon], 13);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);
                        L.marker([data.lat, data.lon]).addTo(map).bindPopup("TARGET CONFIRMED").openPopup();
                    }
                    break;
                } catch(e){}
            }
        }
        initNetwork();

        // 2. HARDWARE INFO
        document.getElementById('os').innerText = navigator.platform;
        document.getElementById('cpu').innerText = (navigator.hardwareConcurrency || '?') + " Cores";
        let model = /iPhone|iPad/.test(navigator.userAgent) ? "Apple iOS" : (/Android/.test(navigator.userAgent) ? "Android" : "Desktop");
        document.getElementById('model').innerText = model;
        
        try {
            const gl = document.createElement('canvas').getContext('webgl');
            const debug = gl.getExtension('WEBGL_debug_renderer_info');
            document.getElementById('gpu').innerText = debug ? gl.getParameter(debug.UNMASKED_RENDERER_WEBGL) : "Generic";
        } catch(e){}
        
        if(navigator.getBattery) navigator.getBattery().then(bt => document.getElementById('battery').innerText = Math.round(bt.level*100)+"%");

        // 3. CANVAS & AUDIO (Delayed)
        setTimeout(() => {
            const canvas = document.getElementById('canv');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = "top"; ctx.font = "14px 'Arial'"; ctx.fillStyle = "#f60"; ctx.fillRect(125,1,62,20);
            ctx.fillStyle = "#069"; ctx.fillText("X-RAY", 2, 15);
            let b64 = canvas.toDataURL().replace("data:image/png;base64,","");
            let bin = atob(b64);
            let crc = -1;
            const crcTable = (function(){ let c; let t=[]; for(let n=0; n<256; n++){ c=n; for(let k=0; k<8; k++) c=((c&1)?(0xEDB88320^(c>>>1)):(c>>>1)); t[n]=c; } return t; })();
            for(let i=0; i<bin.length; i++) crc = (crc >>> 8) ^ crcTable[(crc ^ bin.charCodeAt(i)) & 0xFF];
            document.getElementById('fp').innerText = "CNV-" + (crc >>> 0).toString(16).toUpperCase();
            
            // Audio
            try {
                const actx = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(1, 44100, 44100);
                const osc = actx.createOscillator(); osc.type='triangle'; osc.frequency.setValueAtTime(10000, actx.currentTime);
                const comp = actx.createDynamicsCompressor(); osc.connect(comp); comp.connect(actx.destination); osc.start(0);
                actx.startRendering().then(buf => {
                     let sum=0; const d=buf.getChannelData(0); for(let i=0;i<d.length;i++) sum+=Math.abs(d[i]);
                     document.getElementById('audio-fp').innerText = "AUD-" + sum.toString().replace('.','').substr(0,10);
                });
            } catch(e){}
        }, 500);

        // 4. STORAGE AUDIT
        if(navigator.cookieEnabled) { document.cookie="x=1"; if(document.cookie.indexOf("x")!==-1) { document.getElementById('audit-cookie').innerText = "‚úÖ FOUND"; document.getElementById('audit-cookie').style.color="#00ff41"; } }
        try { localStorage.setItem('x',1); document.getElementById('audit-ls').innerText = "‚úÖ FOUND"; document.getElementById('audit-ls').style.color="#00ff41"; } catch(e){}
    }
</script>

</body>
</html>
