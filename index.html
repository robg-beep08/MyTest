<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital X-RAY | Forensic Scanner Pro</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        :root { --neon: #00ff41; --alert: #ff3e3e; --warn: #ffca28; --bg: #050505; --card: #111; --blue: #00f3ff; }
        body { font-family: 'Segoe UI', 'Courier New', monospace; background: var(--bg); color: #ccc; margin: 0; padding: 20px; overflow-x: hidden; }
        .wrapper { max-width: 1200px; margin: auto; }
        
        /* Header */
        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--neon); padding-bottom: 15px; }
        h1 { color: var(--neon); margin: 0; text-transform: uppercase; letter-spacing: 4px; font-size: 2rem; text-shadow: 0 0 10px rgba(0, 255, 65, 0.5); }
        .subtitle { color: var(--blue); font-size: 0.8rem; letter-spacing: 2px; margin-top: 5px; animation: blink 2s infinite; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        
        /* Cards */
        .card { background: var(--card); border: 1px solid #333; border-left: 3px solid var(--neon); padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.7); position: relative; }
        h2 { color: var(--neon); font-size: 1.1rem; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; display: flex; align-items: center; }
        
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; font-size: 0.85rem; }
        .label { color: #888; font-weight: bold; }
        .val { color: var(--blue); font-weight: bold; text-align: right; word-break: break-all; max-width: 60%; font-family: monospace; }
        .highlight { color: var(--neon); }
        .danger { color: var(--alert); }
        
        /* Mappa */
        #map { 
            height: 200px; width: 100%; margin-top: 15px; border: 1px solid var(--neon);
            filter: invert(100%) hue-rotate(180deg) brightness(90%) contrast(120%);
        }

        /* Badge di Sicurezza */
        .security-badge {
            background: rgba(255, 62, 62, 0.1); border-left: 4px solid var(--alert);
            color: #fff; padding: 10px; font-weight: bold; font-size: 0.8rem;
            margin-top: 10px; display: none; animation: slideIn 0.5s ease-out;
        }

        /* Zombie Audit Grid */
        .audit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .audit-item { background: #1a1a1a; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; }
        .audit-status { font-weight: bold; }
        .detected { color: var(--neon); }
        .clean { color: #444; }

        @keyframes blink { 50% { opacity: 0.5; } }
        @keyframes slideIn { from { opacity:0; transform: translateX(-20px); } to { opacity:1; transform: translateX(0); } }
    </style>
</head>
<body>

<div class="wrapper">
    <header>
        <h1>Digital X-RAY v5.0</h1>
        <div class="subtitle">>>> SYSTEM STATUS: MONITORING <<<</div>
    </header>
    
    <div class="grid">
        <div class="card" style="border-left-color: var(--blue);">
            <h2>üì° Network Analysis</h2>
            <div class="row"><span class="label">Public IPv4:</span> <span id="ip" class="val highlight">SCANNING...</span></div>
            <div class="row"><span class="label">ISP / Carrier:</span> <span id="isp" class="val">...</span></div>
            <div class="row"><span class="label">Location:</span> <span id="geo" class="val">...</span></div>
            <div class="row"><span class="label">Timezone (IP):</span> <span id="ip-tz" class="val">...</span></div>
            <div class="row" style="background: rgba(255,0,0,0.1);"><span class="label" style="color:var(--alert)">WebRTC Leak (Local IP):</span> <span id="webrtc" class="val">TESTING...</span></div>
            
            <div id="vpn-warn" class="security-badge">‚ö†Ô∏è VPN DETECTED (Timezone Mismatch)</div>
            <div id="map"></div>
        </div>

        <div class="card">
            <h2>üì± Device Fingerprint</h2>
            <div class="row"><span class="label">Estimated Model:</span> <span id="model" class="val">DETECTING...</span></div>
            <div class="row"><span class="label">OS:</span> <span id="os" class="val"></span></div>
            <div class="row"><span class="label">CPU Cores:</span> <span id="cpu" class="val"></span></div>
            <div class="row"><span class="label">GPU Renderer:</span> <span id="gpu" class="val"></span></div>
            <div class="row"><span class="label">Screen:</span> <span id="screen" class="val"></span></div>
            <div class="row"><span class="label">Battery:</span> <span id="battery" class="val">N/A</span></div>
        </div>

        <div class="card" style="border-left-color: var(--warn);">
            <h2>üïµÔ∏è Privacy Vectors</h2>
            <div class="row"><span class="label">Browser:</span> <span id="browser" class="val"></span></div>
            <div class="row"><span class="label">System Timezone:</span> <span id="sys-tz" class="val"></span></div>
            <div class="row"><span class="label">Language:</span> <span id="lang" class="val"></span></div>
            
            <div id="incognito-warn" class="security-badge" style="border-color: var(--warn); color: var(--warn);">üïµÔ∏è INCOGNITO MODE DETECTED</div>
            <div id="adblock-warn" class="security-badge" style="border-color: var(--warn); color: var(--warn);">üö´ AD-BLOCKER ACTIVE</div>
        </div>

        <div class="card" style="border-left-color: var(--alert);">
            <h2>üß¨ Unique IDs & Zombies</h2>
            <p style="font-size:0.75rem; color:#666; margin-bottom:10px;">Persistent identifiers (Resistant to VPN).</p>
            
            <div class="row"><span class="label">Canvas Fingerprint:</span> <span id="fp" class="val danger">WAITING...</span></div>
            <div class="row"><span class="label">Audio Context Hash:</span> <span id="audio-fp" class="val danger">WAITING...</span></div>

            <h3 style="color: var(--neon); font-size: 0.9rem; margin-top: 20px; border-bottom: 1px solid #333;">üßü Storage Audit</h3>
            <div class="audit-grid">
                <div class="audit-item"><span class="audit-label">üç™ Cookies</span><span id="audit-cookie" class="audit-status clean">Checking...</span></div>
                <div class="audit-item"><span class="audit-label">üì¶ LocalStorage</span><span id="audit-ls" class="audit-status clean">Checking...</span></div>
                <div class="audit-item"><span class="audit-label">üóÑÔ∏è IndexedDB</span><span id="audit-idb" class="audit-status clean">Checking...</span></div>
            </div>
             <div id="persistence-msg" style="margin-top:10px; font-size:0.8rem; color: var(--blue); text-align:center;"></div>
        </div>
    </div>
</div>

<canvas id="canv" width="200" height="50" style="display:none;"></canvas>
<div id="ad-test" style="position:absolute; top:-999px; left:-999px; width:1px; height:1px;" class="ads ad-banner"></div>

<script>
    // --- 1. SYSTEM INFO BASE ---
    const sysTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    document.getElementById('sys-tz').innerText = sysTimezone;
    document.getElementById('os').innerText = navigator.platform;
    document.getElementById('screen').innerText = `${screen.width}x${screen.height}`;
    document.getElementById('lang').innerText = navigator.language;
    document.getElementById('cpu').innerText = (navigator.hardwareConcurrency || '?') + " Cores";

    // Browser Logic
    const ua = navigator.userAgent;
    let b = "Unknown";
    if (ua.includes("OPR") || ua.includes("Opera")) b = "Opera";
    else if (ua.includes("Edg")) b = "Edge";
    else if (ua.includes("Chrome")) b = "Chrome";
    else if (ua.includes("Firefox")) b = "Firefox";
    else if (ua.includes("Safari")) b = "Safari";
    document.getElementById('browser').innerText = b;

    // Mobile/PC check
    let model = "Desktop PC";
    if (/android/i.test(ua)) model = "Android";
    if (/iPhone|iPad/.test(ua)) model = "Apple iOS";
    document.getElementById('model').innerText = model;

    // GPU
    try {
        const gl = document.createElement('canvas').getContext('webgl');
        const debug = gl.getExtension('WEBGL_debug_renderer_info');
        document.getElementById('gpu').innerText = debug ? gl.getParameter(debug.UNMASKED_RENDERER_WEBGL) : "Generic";
    } catch(e){}

    // Battery
    if(navigator.getBattery) navigator.getBattery().then(bt => document.getElementById('battery').innerText = Math.round(bt.level*100)+"%");

    // --- 2. NETWORK & MAP ---
    async function initNetwork() {
        // Fonti multiple per evitare blocchi
        const sources = [
            { url: 'https://ipwho.is/', map: d => ({ ip: d.ip, geo: `${d.city}, ${d.country}`, isp: d.connection.isp, lat: d.latitude, lon: d.longitude, tz: d.timezone.id }) },
            { url: 'https://ipapi.co/json/', map: d => ({ ip: d.ip, geo: `${d.city}, ${d.country_name}`, isp: d.org, lat: d.latitude, lon: d.longitude, tz: d.timezone }) }
        ];

        for(const source of sources) {
            try {
                const res = await fetch(source.url);
                if(!res.ok) throw new Error("Err");
                const data = source.map(await res.json());

                document.getElementById('ip').innerText = data.ip;
                document.getElementById('geo').innerText = data.geo;
                document.getElementById('isp').innerText = data.isp;
                document.getElementById('ip-tz').innerText = data.tz || "?";

                // VPN Check (Confronto Fuso Orario)
                if(data.tz && data.tz !== sysTimezone) {
                    const warn = document.getElementById('vpn-warn');
                    warn.style.display = 'block';
                    warn.innerHTML = `‚ö†Ô∏è VPN DETECTED: System (${sysTimezone}) != IP (${data.tz})`;
                }

                // Mappa
                if(data.lat && typeof L !== 'undefined') {
                    const map = L.map('map').setView([data.lat, data.lon], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);
                    L.marker([data.lat, data.lon]).addTo(map).bindPopup("TARGET LOCATION").openPopup();
                }
                break; // Stop se funziona
            } catch(e){}
        }
    }
    initNetwork();

    // --- 3. CANVAS FINGERPRINT OTTIMIZZATO (Non-Blocking) ---
    // Usiamo setTimeout per ritardare l'esecuzione e non bloccare il rendering iniziale
    setTimeout(() => {
        try {
            const canvas = document.getElementById('canv');
            const ctx = canvas.getContext('2d');
            
            // Disegno complesso ma veloce
            ctx.textBaseline = "top";
            ctx.font = "14px 'Arial'";
            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125,1,62,20);
            ctx.fillStyle = "#069";
            ctx.fillText("X-RAY v5.0", 2, 15);
            ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
            ctx.fillText("X-RAY v5.0", 4, 17);

            // Estrazione Hash
            let b64 = canvas.toDataURL().replace("data:image/png;base64,","");
            let bin = atob(b64);
            let crc = -1;
            // Algoritmo CRC veloce
            for(let i=0; i<bin.length; i++) {
                crc = (crc >>> 8) ^ crcTable[(crc ^ bin.charCodeAt(i)) & 0xFF];
            }
            let fp = "CNV-" + (crc >>> 0).toString(16).toUpperCase();
            
            document.getElementById('fp').innerText = fp;
            checkPersistence(fp); // Controlla se l'utente √® tornato

        } catch(e) {
            document.getElementById('fp').innerText = "BLOCKED";
        }
    }, 800); // 800ms di ritardo per fluidit√†

    // --- 4. AUDIO FINGERPRINT (Leggero) ---
    setTimeout(async () => {
        try {
            const ctx = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(1, 44100, 44100);
            const osc = ctx.createOscillator();
            osc.type = 'triangle'; osc.frequency.setValueAtTime(10000, ctx.currentTime);
            const comp = ctx.createDynamicsCompressor();
            osc.connect(comp); comp.connect(ctx.destination); osc.start(0);
            const buffer = await ctx.startRendering();
            const data = buffer.getChannelData(0);
            let sum = 0; for(let i=0; i<data.length; i++) sum += Math.abs(data[i]);
            document.getElementById('audio-fp').innerText = "AUD-" + sum.toString().replace('.','').substr(0,10);
        } catch(e) { document.getElementById('audio-fp').innerText = "SILENCED"; }
    }, 1200);

    // --- 5. PRIVACY CHECKS & ZOMBIE AUDIT ---
    
    // AdBlock Check
    setTimeout(() => {
        if(document.getElementById('ad-test').clientHeight === 0) 
            document.getElementById('adblock-warn').style.display = 'block';
    }, 1000);

    // Incognito Check (Quota Storage)
    if('storage' in navigator && 'estimate' in navigator.storage) {
        navigator.storage.estimate().then(est => {
            if(est.quota < 120000000) document.getElementById('incognito-warn').style.display = 'block';
        });
    }

    // Zombie Storage Audit
    function markDetected(id) {
        const el = document.getElementById(id);
        el.innerText = "‚úÖ FOUND"; el.classList.remove('clean'); el.classList.add('detected');
    }

    function checkPersistence(currentFP) {
        // Cookie
        if(navigator.cookieEnabled) {
            document.cookie = "xray_zombie=1; SameSite=Lax";
            if(document.cookie.indexOf("xray_zombie") !== -1) markDetected('audit-cookie');
        }
        // Local/Session Storage
        try { localStorage.setItem('xray_test',1); markDetected('audit-ls'); } catch(e){}
        // IndexedDB
        try {
            const req = indexedDB.open("XRayZombieDB", 1);
            req.onupgradeneeded = (e) => e.target.result.createObjectStore("s");
            req.onsuccess = (e) => { markDetected('audit-idb'); e.target.result.close(); };
        } catch(e){}

        // Magic Trick: Hardware ID Persistence
        const lastFP = localStorage.getItem('xray_last_id');
        const msg = document.getElementById('persistence-msg');
        
        if(lastFP === currentFP) {
            msg.innerHTML = "<strong style='color:var(--alert)'>‚ö†Ô∏è ALERT: DEVICE RE-IDENTIFIED VIA HARDWARE ID!</strong>";
        } else if(lastFP) {
            msg.innerText = "Returning visitor (ID changed slightly).";
        } else {
            msg.innerText = "New Device Profile Created.";
        }
        localStorage.setItem('xray_last_id', currentFP);
    }

    // CRC Table per hashing veloce (riduce carico CPU)
    const crcTable = (function(){
        let c; let table = [];
        for(let n =0; n < 256; n++){
            c = n;
            for(let k =0; k < 8; k++) c = ((c&1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));
            table[n] = c;
        }
        return table;
    })();

    // WebRTC
    const pc = new RTCPeerConnection({iceServers:[]}); pc.createDataChannel(''); pc.createOffer().then(o=>pc.setLocalDescription(o));
    pc.onicecandidate = e => { 
        if(e.candidate) {
            const ip = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(e.candidate.candidate);
            if(ip) document.getElementById('webrtc').innerText = ip[1];
        }
    }
</script>

</body>
</html>
