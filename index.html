<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGITAL X-RAY | Advanced Forensic Scanner</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        :root {
            --bg: #050505;
            --card-bg: #111;
            --neon-green: #00ff41;
            --neon-red: #ff003c;
            --neon-blue: #00f3ff;
            --text-dim: #888;
        }
        body {
            background-color: var(--bg);
            color: #ccc;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* HEADER */
        header { border-bottom: 2px solid var(--neon-green); padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
        h1 { margin: 0; color: var(--neon-green); text-transform: uppercase; letter-spacing: 4px; text-shadow: 0 0 10px rgba(0,255,65,0.5); }
        .subtitle { font-size: 0.8rem; color: var(--neon-green); animation: blink 2s infinite; }

        /* GRID LAYOUT */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        
        /* CARDS */
        .card {
            background: var(--card-bg);
            border: 1px solid #333;
            border-left: 4px solid var(--neon-green);
            padding: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            position: relative;
        }
        .card h2 { margin-top: 0; font-size: 1.1rem; color: #fff; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .data-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; border-bottom: 1px solid #222; padding-bottom: 2px;}
        .label { color: var(--text-dim); }
        .value { color: var(--neon-blue); font-weight: bold; text-align: right; word-break: break-all; }
        .highlight { color: var(--neon-green); }
        .alert { color: var(--neon-red); }

        /* TERMINAL LOG */
        #terminal {
            background: #000; border: 1px solid #333; height: 150px; overflow-y: auto; 
            padding: 10px; font-size: 0.8rem; color: var(--neon-green); margin-bottom: 20px;
            font-family: 'Consolas', monospace;
        }
        .log-line { margin: 2px 0; }
        .log-warn { color: var(--neon-red); }

        /* MAP */
        #map { height: 300px; width: 100%; border: 1px solid var(--neon-green); filter: grayscale(100%) invert(100%); margin-top: 10px; }

        /* PROBABILITY SCORE */
        .score-box {
            text-align: center; padding: 20px; border: 2px solid var(--neon-red); 
            background: rgba(255, 0, 60, 0.1); margin-top: 20px;
        }
        .score-val { font-size: 3rem; font-weight: bold; color: var(--neon-red); display: block; }
        .score-desc { font-size: 0.9rem; color: #fff; text-transform: uppercase; }

        @keyframes blink { 50% { opacity: 0; } }
        
        /* HIDDEN CANVAS */
        #fingerprint-canvas { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Digital X-RAY v3.0</h1>
        <div class="subtitle">SYSTEM STATUS: SURVEILLANCE ACTIVE</div>
    </header>

    <div id="terminal">
        <div class="log-line">Initializing core modules...</div>
    </div>

    <div class="grid">
        <div class="card">
            <h2>ðŸ“¡ Network Intelligence</h2>
            <div class="data-row"><span class="label">Public IPv4:</span> <span id="ip" class="value">SCANNING...</span></div>
            <div class="data-row"><span class="label">ISP / Org:</span> <span id="isp" class="value">...</span></div>
            <div class="data-row"><span class="label">Connection Type:</span> <span id="conn" class="value">...</span></div>
            <div class="data-row"><span class="label">Location:</span> <span id="geo" class="value">...</span></div>
            <div class="data-row"><span class="label">WebRTC Leak:</span> <span id="webrtc" class="value alert">TESTING...</span></div>
            <div id="map"></div>
        </div>

        <div class="card">
            <h2>ðŸ“± Hardware Forensics</h2>
            <div class="data-row"><span class="label">OS / Platform:</span> <span id="os" class="value">...</span></div>
            <div class="data-row"><span class="label">Browser Engine:</span> <span id="browser" class="value">...</span></div>
            <div class="data-row"><span class="label">Screen Geometry:</span> <span id="screen" class="value">...</span></div>
            <div class="data-row"><span class="label">CPU Cores:</span> <span id="cpu" class="value">...</span></div>
            <div class="data-row"><span class="label">GPU Renderer:</span> <span id="gpu" class="value">...</span></div>
            <div class="data-row"><span class="label">Battery Status:</span> <span id="battery" class="value">...</span></div>
        </div>

        <div class="card" style="border-left-color: var(--neon-blue);">
            <h2>ðŸ§¬ Unique Identifiers</h2>
            <p style="font-size:0.75rem; color:#666; margin:0 0 10px 0;">Calculated from hardware imperfections.</p>
            
            <div class="data-row">
                <span class="label">Canvas Hash:</span> 
                <span id="canvas-fp" class="value" style="font-size:0.7rem">CALCULATING...</span>
            </div>
            <div class="data-row">
                <span class="label">Audio Context Hash:</span> 
                <span id="audio-fp" class="value" style="font-size:0.7rem">CALCULATING...</span>
            </div>
            
            <div id="identity-match" style="display:none;">
                <div class="score-box">
                    <span class="score-desc">Re-Identification Probability</span>
                    <span id="score-val" class="score-val">0%</span>
                    <div id="score-msg" style="margin-top:5px; font-weight:bold;">ANALYZING...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<canvas id="fingerprint-canvas" width="200" height="50"></canvas>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
    // UTILS: Terminal Logger
    const term = document.getElementById('terminal');
    const log = (msg, type='info') => {
        const div = document.createElement('div');
        div.className = 'log-line ' + (type === 'warn' ? 'log-warn' : '');
        div.innerText = `> [${new Date().toLocaleTimeString()}] ${msg}`;
        term.appendChild(div);
        term.scrollTop = term.scrollHeight;
    };

    // --- 1. FINGERPRINTING ENGINE ---

    // A. Canvas Fingerprinting
    const getCanvasFp = () => {
        log("Rendering hidden Canvas ghost image...");
        const canvas = document.getElementById('fingerprint-canvas');
        const ctx = canvas.getContext('2d');
        // Disegno complesso per stressare il rendering
        ctx.textBaseline = "top";
        ctx.font = "14px 'Arial'";
        ctx.fillStyle = "#f60";
        ctx.fillRect(125,1,62,20);
        ctx.fillStyle = "#069";
        ctx.fillText("X-RAY v3.0", 2, 15);
        ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
        ctx.fillText("X-RAY v3.0", 4, 17);
        
        // Hashing
        const b64 = canvas.toDataURL().replace("data:image/png;base64,","");
        const bin = atob(b64);
        let hash = 0;
        for (let i = 0; i < bin.length; i++) {
            hash = ((hash << 5) - hash) + bin.charCodeAt(i);
            hash |= 0;
        }
        const finalHash = "CNV-" + Math.abs(hash).toString(16).toUpperCase();
        document.getElementById('canvas-fp').innerText = finalHash;
        log(`Canvas Signature extracted: ${finalHash}`);
        return finalHash;
    };

    // B. Audio Fingerprinting (AudioContext)
    const getAudioFp = async () => {
        try {
            log("Accessing AudioContext oscillator...");
            const audioCtx = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(1, 44100, 44100);
            const osc = audioCtx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(10000, audioCtx.currentTime);
            const compressor = audioCtx.createDynamicsCompressor();
            
            // Parametri compressore
            compressor.threshold.setValueAtTime(-50, audioCtx.currentTime);
            compressor.knee.setValueAtTime(40, audioCtx.currentTime);
            compressor.ratio.setValueAtTime(12, audioCtx.currentTime);
            compressor.attack.setValueAtTime(0, audioCtx.currentTime);
            compressor.release.setValueAtTime(0.25, audioCtx.currentTime);

            osc.connect(compressor);
            compressor.connect(audioCtx.destination);
            osc.start(0);
            
            const buffer = await audioCtx.startRendering();
            const data = buffer.getChannelData(0);
            let sum = 0;
            // Calcolo hash semplice sui dati audio
            for (let i = 0; i < data.length; i++) sum += Math.abs(data[i]);
            
            const fp = "AUD-" + sum.toString().replace('.', '').substring(0, 10);
            document.getElementById('audio-fp').innerText = fp;
            log(`Audio Stack footprint
